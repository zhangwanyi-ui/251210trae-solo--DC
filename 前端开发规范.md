# DC在线业务系统 - 前端开发规范

## 1. 文档概述

### 1.1 文档目的

本文档详细描述了DC在线业务系统的前端开发规范，包括技术栈、项目结构、命名规范、代码风格、组件开发、状态管理、API调用、样式管理等，为前端开发团队提供明确的开发依据，确保前端代码质量高、风格统一、易于维护和扩展。

### 1.2 适用范围

本规范适用于DC在线业务系统的前端开发团队，包括新功能开发、代码维护、性能优化等所有前端相关工作。

## 2. 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18+ | 前端框架 |
| Vite | 5+ | 构建工具 |
| React Router | 6+ | 路由管理 |
| Ant Design | 5+ | UI组件库 |
| Redux Toolkit | 2+ | 状态管理 |
| Axios | 1.6+ | HTTP请求 |
| CSS Modules | - | 样式模块化 |
| Less | 4+ | CSS预处理器 |
| ECharts | 5+ | 数据可视化 |
| Mock.js | 1.1+ | 模拟API数据 |
| Jest | 29+ | 单元测试 |
| React Testing Library | 14+ | 组件测试 |

## 3. 项目结构

### 3.1 目录结构

```
├── public/                  # 静态资源目录
│   ├── favicon.ico         # 网站图标
│   └── index.html          # HTML模板
├── src/                     # 源代码目录
│   ├── assets/             # 资源文件
│   │   ├── images/        # 图片资源
│   │   ├── icons/         # 图标资源
│   │   └── styles/        # 全局样式
│   ├── components/         # 通用组件
│   │   ├── TopNav/        # 顶部导航组件
│   │   ├── SideNav/       # 左侧导航组件
│   │   ├── ContentArea/   # 内容区域组件
│   │   └── common/        # 通用基础组件
│   ├── hooks/             # 自定义Hooks
│   ├── pages/             # 页面组件
│   │   ├── Overview/      # 全景俯瞰页面
│   │   ├── OnlineBusiness/ # 在线业务页面
│   │   ├── ApplicationService/ # 应用服务页面
│   │   ├── BasicResource/ # 基础资源页面
│   │   └── ServiceHealth/ # 服务健康页面
│   ├── routes/            # 路由配置
│   │   └── routes.jsx     # 路由定义
│   ├── services/          # 服务层
│   │   ├── api.js         # API请求封装
│   │   ├── mockData.js    # Mock数据
│   │   └── request.js     # Axios配置
│   ├── store/             # Redux状态管理
│   │   ├── slices/        # Redux slices
│   │   └── index.js       # Store配置
│   ├── utils/             # 工具函数
│   │   ├── common.js      # 通用工具
│   │   ├── format.js       # 格式化工具
│   │   └── validate.js     # 验证工具
│   ├── App.jsx            # 应用根组件
│   ├── main.jsx           # 应用入口文件
│   └── vite-env.d.ts      # Vite环境类型定义
├── .eslintrc.cjs          # ESLint配置
├── .prettierrc.json       # Prettier配置
├── index.html             # HTML入口文件
├── package.json           # 项目配置和依赖
├── vite.config.js         # Vite配置
└── README.md              # 项目说明文档
```

### 3.2 文件组织原则

- **组件化**：将页面拆分为可复用的组件
- **模块化**：按功能模块组织代码
- **单一职责**：每个文件只负责一个功能
- **高内聚低耦合**：相关功能放在一起，减少模块间依赖
- **易于扩展**：预留扩展空间，便于后续功能迭代

## 4. 命名规范

### 4.1 文件命名

- **组件文件**：PascalCase，如 `TopNav.jsx`、`SideNav.jsx`
- **样式文件**：组件名.module.less，如 `TopNav.module.less`、`SideNav.module.less`
- **工具文件**：camelCase，如 `common.js`、`format.js`
- **配置文件**：kebab-case，如 `vite.config.js`、`.eslintrc.cjs`
- **路由文件**：kebab-case，如 `routes.jsx`

### 4.2 组件命名

- **组件名**：PascalCase，如 `TopNav`、`SideNav`
- **Props名**：camelCase，如 `isCollapsed`、`activeKey`
- **State名**：camelCase，如 `navItems`、`activeTabKey`

### 4.3 变量命名

- **普通变量**：camelCase，如 `userInfo`、`isLoading`
- **常量**：UPPER_SNAKE_CASE，如 `API_BASE_URL`、`MAX_PAGE_SIZE`
- **数组**：复数形式，如 `users`、`items`
- **布尔值**：is/has/should前缀，如 `isVisible`、`hasPermission`

### 4.4 函数命名

- **普通函数**：camelCase，如 `handleClick`、`fetchData`
- **事件处理函数**：handle前缀，如 `handleSubmit`、`handleChange`
- **异步函数**：async前缀或使用async/await，如 `asyncFetchData`
- **Hook函数**：use前缀，如 `useAuth`、`usePagination`

## 5. 代码风格

### 5.1 缩进和换行

- **缩进**：使用2个空格进行缩进
- **换行**：单行代码长度不超过120个字符
- **空行**：在函数、类、逻辑块之间添加适当空行
- **大括号**：使用K&R风格，左大括号不换行

### 5.2 引号和分号

- **字符串**：使用单引号 `'`
- **对象属性**：当属性名是关键字或包含特殊字符时使用引号
- **分号**：必须使用分号

### 5.3 代码示例

```javascript
// 组件示例
import React, { useState, useEffect } from 'react';
import { Button } from 'antd';
import styles from './Example.module.less';

const Example = ({ title, onButtonClick }) => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    // 副作用逻辑
    return () => {
      // 清理逻辑
    };
  }, [count]);

  const handleClick = () => {
    setCount(count + 1);
    onButtonClick && onButtonClick(count + 1);
  };

  return (
    <div className={styles.example}>
      <h2>{title}</h2>
      <p>Count: {count}</p>
      <Button type="primary" onClick={handleClick}>
        Increment
      </Button>
    </div>
  );
};

export default Example;
```

## 6. 组件开发

### 6.1 组件设计原则

- **单一职责**：每个组件只负责一个功能
- **可复用性**：设计通用组件，提高复用率
- **可维护性**：组件结构清晰，易于理解和维护
- **可测试性**：组件易于测试
- **性能优化**：避免不必要的渲染和计算

### 6.2 组件结构

```javascript
// 组件结构
import React from 'react';
import PropTypes from 'prop-types';
import styles from './ComponentName.module.less';

// 组件属性类型定义
const propTypes = {
  prop1: PropTypes.string.isRequired,
  prop2: PropTypes.number,
  prop3: PropTypes.func,
};

// 组件默认属性
const defaultProps = {
  prop2: 0,
  prop3: () => {},
};

// 组件定义
const ComponentName = ({ prop1, prop2, prop3 }) => {
  // 组件逻辑
  return (
    <div className={styles.componentName}>
      {/* 组件内容 */}
    </div>
  );
};

// 设置属性类型和默认属性
ComponentName.propTypes = propTypes;
ComponentName.defaultProps = defaultProps;

export default ComponentName;
```

### 6.3 组件通信

- **Props**：父组件向子组件传递数据
- **Events**：子组件向父组件传递事件
- **Context**：跨组件传递数据
- **Redux**：全局状态管理

### 6.4 Hooks使用规范

- **只在函数组件或自定义Hooks中使用Hooks**
- **不要在循环、条件或嵌套函数中调用Hooks**
- **Hook的调用顺序要一致**
- **自定义Hooks要使用use前缀**

## 7. 状态管理

### 7.1 Redux Toolkit使用规范

- **使用createSlice创建切片**：包含state、reducers、extraReducers
- **使用configureStore配置Store**：包含reducer、middleware、devTools
- **使用useSelector和useDispatch访问和更新状态**
- **使用createAsyncThunk处理异步操作**
- **避免不必要的全局状态**：只将需要跨组件共享的状态放入Redux

### 7.2 切片结构

```javascript
// 切片示例
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { fetchUsers } from '../services/api';

// 异步Thunk
const getUsers = createAsyncThunk('users/getUsers', async (params, { rejectWithValue }) => {
  try {
    const response = await fetchUsers(params);
    return response.data;
  } catch (error) {
    return rejectWithValue(error.response.data);
  }
});

// 初始状态
const initialState = {
  users: [],
  loading: false,
  error: null,
  total: 0,
};

// 切片定义
const usersSlice = createSlice({
  name: 'users',
  initialState,
  reducers: {
    clearUsers: (state) => {
      state.users = [];
      state.total = 0;
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(getUsers.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(getUsers.fulfilled, (state, action) => {
        state.loading = false;
        state.users = action.payload.list;
        state.total = action.payload.total;
      })
      .addCase(getUsers.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      });
  },
});

// 导出actions
export const { clearUsers } = usersSlice.actions;
export { getUsers };

// 导出reducer
export default usersSlice.reducer;
```

## 8. API调用

### 8.1 Axios配置

- **统一配置**：在services/request.js中配置Axios实例
- **请求拦截器**：添加认证令牌、请求日志等
- **响应拦截器**：统一处理响应、错误处理等
- **超时设置**：设置合理的超时时间

### 8.2 API封装

```javascript
// request.js - Axios配置
import axios from 'axios';
import { message } from 'antd';
import { getToken } from '../utils/auth';

// 创建Axios实例
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器
service.interceptors.request.use(
  (config) => {
    // 添加认证令牌
    const token = getToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    console.error('Request error:', error);
    return Promise.reject(error);
  }
);

// 响应拦截器
service.interceptors.response.use(
  (response) => {
    const res = response.data;
    
    // 处理业务错误
    if (res.code !== 200) {
      message.error(res.message || '请求失败');
      return Promise.reject(new Error(res.message || '请求失败'));
    }
    
    return res;
  },
  (error) => {
    console.error('Response error:', error);
    message.error(error.message || '网络错误');
    return Promise.reject(error);
  }
);

export default service;
```

### 8.3 API调用规范

- **使用async/await处理异步请求**
- **统一错误处理**
- **添加loading状态**
- **避免不必要的请求**
- **使用缓存机制**

## 9. 样式管理

### 9.1 CSS Modules使用规范

- **组件样式文件命名**：组件名.module.less
- **使用类名前缀**：避免类名冲突
- **不使用ID选择器**：优先使用类选择器
- **避免全局样式**：除非必要，否则不使用:global()

### 9.2 Less使用规范

- **变量定义**：在assets/styles/variables.less中定义全局变量
- **混合宏**：在assets/styles/mixins.less中定义通用混合宏
- **嵌套规则**：不超过3层嵌套
- **避免!important**：除非必要，否则不使用!important

### 9.3 样式示例

```less
// variables.less - 全局变量
@primary-color: #1890ff;
@success-color: #52c41a;
@warning-color: #faad14;
@error-color: #f5222d;
@text-color: #333;
@border-color: #e8e8e8;

// mixins.less - 混合宏
.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

// ComponentName.module.less - 组件样式
.componentName {
  padding: 16px;
  border: 1px solid @border-color;
  border-radius: 4px;
  
  .title {
    font-size: 18px;
    font-weight: bold;
    color: @text-color;
    margin-bottom: 16px;
  }
  
  .content {
    .flex-center;
    
    .item {
      margin: 0 8px;
      padding: 8px 16px;
      background-color: @primary-color;
      color: white;
      border-radius: 4px;
    }
  }
}
```

## 10. 路由管理

### 10.1 React Router 6使用规范

- **使用Routes替代Switch**
- **使用Route的element属性指定组件**
- **使用useNavigate替代useHistory**
- **使用useParams获取路由参数**
- **使用Navigate进行重定向**

### 10.2 路由配置

```javascript
// routes.jsx - 路由配置
import { createBrowserRouter } from 'react-router-dom';
import App from '../App';
import DefaultPage from '../pages/DefaultPage';
import Overview from '../pages/Overview/Overview';
import Visitors from '../pages/OnlineBusiness/Visitors';
// 其他页面导入

// 路由定义
const router = createBrowserRouter([
  {
    path: '/',
    element: <App />,
    children: [
      // 首页重定向
      {
        index: true,
        element: <Overview />,
      },
      // 全景俯瞰
      {
        path: 'overview',
        children: [
          {
            index: true,
            element: <Overview />,
          },
          {
            path: 'operation-overview',
            element: <DefaultPage title="运营全景" />,
          },
          // 其他子路由
        ],
      },
      // 在线业务
      {
        path: 'online-business',
        children: [
          {
            path: 'visitors',
            element: <Visitors />,
          },
          // 其他子路由
        ],
      },
      // 其他模块路由
    ],
  },
  // 登录页面
  {
    path: '/login',
    element: <Login />,
  },
  // 404页面
  {
    path: '*',
    element: <NotFound />,
  },
]);

export default router;
```

## 11. 数据可视化

### 11.1 ECharts使用规范

- **使用useRef保存图表实例**
- **使用useEffect初始化和更新图表**
- **合理设置图表大小和自适应**
- **避免内存泄漏**：在组件卸载时销毁图表

### 11.2 图表组件示例

```javascript
// ChartComponent.jsx - 图表组件示例
import React, { useRef, useEffect } from 'echarts';
import * as echarts from 'echarts';
import styles from './ChartComponent.module.less';

const ChartComponent = ({ data, options }) => {
  const chartRef = useRef(null);
  const chartInstanceRef = useRef(null);

  useEffect(() => {
    // 初始化图表
    if (chartRef.current && !chartInstanceRef.current) {
      chartInstanceRef.current = echarts.init(chartRef.current);
    }

    // 更新图表数据
    if (chartInstanceRef.current) {
      const defaultOptions = {
        title: {
          text: '图表标题',
        },
        tooltip: {},
        xAxis: {
          type: 'category',
          data: data.xAxis,
        },
        yAxis: {
          type: 'value',
        },
        series: [
          {
            data: data.series,
            type: 'line',
          },
        ],
      };

      chartInstanceRef.current.setOption({ ...defaultOptions, ...options });
    }

    // 自适应大小
    const handleResize = () => {
      chartInstanceRef.current?.resize();
    };

    window.addEventListener('resize', handleResize);

    // 清理函数
    return () => {
      window.removeEventListener('resize', handleResize);
      chartInstanceRef.current?.dispose();
      chartInstanceRef.current = null;
    };
  }, [data, options]);

  return <div className={styles.chartContainer} ref={chartRef} />;
};

export default ChartComponent;
```

## 12. 测试规范

### 12.1 测试类型

- **单元测试**：测试单个函数或组件
- **集成测试**：测试组件之间的交互
- **E2E测试**：测试完整的用户流程

### 12.2 测试覆盖率

- **目标覆盖率**：≥80%
- **关键功能**：100%覆盖
- **工具**：Jest + React Testing Library

### 12.3 测试文件命名

- **测试文件位置**：与被测试文件在同一目录下
- **测试文件名**：[被测试文件].test.jsx或[被测试文件].spec.jsx

### 12.4 测试示例

```javascript
// Component.test.jsx - 组件测试示例
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import '@testing-library/jest-dom';
import Component from './Component';

describe('Component', () => {
  test('renders correctly', () => {
    render(<Component title="Test" />);
    expect(screen.getByText('Test')).toBeInTheDocument();
  });

  test('calls onButtonClick when button is clicked', () => {
    const handleClick = jest.fn();
    render(<Component title="Test" onButtonClick={handleClick} />);
    
    fireEvent.click(screen.getByText('Increment'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});
```

## 13. 性能优化

### 13.1 代码优化

- **使用React.memo优化组件渲染**
- **使用useMemo和useCallback缓存计算结果和函数**
- **避免不必要的重渲染**
- **使用虚拟列表处理大量数据**

### 13.2 资源优化

- **图片优化**：使用适当大小的图片，使用WebP格式
- **代码分割**：使用动态导入拆分代码
- **懒加载**：使用React.lazy和Suspense懒加载组件
- **CDN加速**：将静态资源部署到CDN

### 13.3 网络优化

- **减少HTTP请求**：合并请求，使用HTTP/2
- **使用缓存**：合理设置缓存策略
- **压缩资源**：启用Gzip压缩
- **使用预加载**：使用rel="preload"预加载关键资源

## 14. 代码审查

### 14.1 审查标准

- **代码风格**：符合本规范
- **代码质量**：可读性高，易于维护
- **性能**：无明显性能问题
- **安全性**：无安全漏洞
- **测试覆盖率**：达到目标要求

### 14.2 审查流程

1. **提交代码**：开发者提交代码到Git仓库
2. **创建PR**：创建Pull Request
3. **代码审查**：其他开发者审查代码
4. **修改代码**：根据审查意见修改代码
5. **合并代码**：审查通过后合并代码

## 15. 版本控制

### 15.1 Git使用规范

- **分支管理**：使用Git Flow或GitHub Flow
- **提交信息**：清晰、简洁，使用英文
- **提交频率**：小步提交，频繁提交
- **代码冲突**：及时解决代码冲突
- **标签管理**：使用语义化版本号打标签

### 15.2 提交信息格式

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type**：
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码风格调整
- refactor: 代码重构
- test: 测试代码
- chore: 构建流程或辅助工具变动

**示例**：
```
feat(TopNav): 添加用户头像下拉菜单

- 实现用户头像点击显示下拉菜单
- 添加个人中心、退出登录等选项
- 响应式设计适配不同屏幕尺寸
```

## 16. 附录

### 16.1 常用工具

- **VS Code**：推荐的代码编辑器
- **ESLint**：代码质量检查
- **Prettier**：代码格式化
- **GitLens**：Git增强插件
- **React DevTools**：React调试工具
- **Redux DevTools**：Redux调试工具

### 16.2 资源链接

- [React官方文档](https://react.dev/)
- [Vite官方文档](https://vite.dev/)
- [React Router官方文档](https://reactrouter.com/)
- [Ant Design官方文档](https://ant.design/)
- [Redux Toolkit官方文档](https://redux-toolkit.js.org/)
- [Axios官方文档](https://axios-http.com/)
- [ECharts官方文档](https://echarts.apache.org/)

### 16.3 联系方式

| 角色 | 姓名 | 联系方式 |
|------|------|----------|
| 前端开发负责人 | XXX | XXX@example.com |
| UI设计师 | XXX | XXX@example.com |
| 产品经理 | XXX | XXX@example.com |