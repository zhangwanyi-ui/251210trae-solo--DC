{"version":3,"file":"index.js","sources":["../src/CanvasRendererPlugin.ts","../src/shapes/styles/helper.ts","../src/shapes/styles/OptimizedDefault.ts","../src/shapes/styles/Default.ts","../src/utils/math.ts","../src/shapes/styles/Image.ts","../src/shapes/styles/Text.ts","../src/index.ts"],"sourcesContent":["import type {\n  DisplayObject,\n  FederatedEvent,\n  RBushNodeAABB,\n  RenderingPlugin,\n  RBush,\n  RenderingPluginContext,\n  ContextService,\n  CanvasContext,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  CSSRGB,\n} from '@antv/g-lite';\nimport {\n  AABB,\n  CanvasEvent,\n  CustomEvent,\n  ElementEvent,\n  Shape,\n  Node,\n} from '@antv/g-lite';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { isNil } from '@antv/util';\nimport type { CanvasRendererPluginOptions } from './interfaces';\nimport type { Plugin } from '.';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface RenderState {\n  restoreStack: DisplayObject[];\n  prevObject: DisplayObject;\n  currentContext: Map<keyof CanvasRenderingContext2D | 'lineDash', unknown>;\n}\n\n/**\n * support 2 modes in rendering:\n * * immediate\n * * delayed: render at the end of frame with dirty-rectangle\n */\nexport class CanvasRendererPlugin implements RenderingPlugin {\n  static tag = 'CanvasRenderer';\n\n  private context: Plugin['context'];\n\n  private pathGeneratorFactory: Plugin['context']['pathGeneratorFactory'];\n\n  /**\n   * RBush used in dirty rectangle rendering\n   */\n  private rBush: RBush<RBushNodeAABB>;\n\n  constructor(\n    private canvasRendererPluginOptions: CanvasRendererPluginOptions, // private styleRendererFactory: Record<Shape, StyleRenderer>,\n  ) {}\n\n  private removedRBushNodeAABBs: RBushNodeAABB[] = [];\n\n  private renderQueue: DisplayObject[] = [];\n\n  #renderState: RenderState = {\n    restoreStack: [],\n    prevObject: null,\n    currentContext: new Map(),\n  };\n\n  private clearFullScreenLastFrame = false;\n  private clearFullScreen = false;\n\n  /**\n   * view projection matrix\n   */\n  private vpMatrix = mat4.create();\n  private dprMatrix = mat4.create();\n  private tmpMat4 = mat4.create();\n  private vec3a = vec3.create();\n  private vec3b = vec3.create();\n  private vec3c = vec3.create();\n  private vec3d = vec3.create();\n\n  apply(context: RenderingPluginContext, runtime: GlobalRuntime) {\n    this.context = context as unknown as Plugin['context'];\n\n    const {\n      config,\n      camera,\n      renderingService,\n      renderingContext,\n      rBushRoot,\n      // @ts-ignore\n      pathGeneratorFactory,\n    } = this.context;\n    let enableRenderingOptimization =\n      config.renderer.getConfig().enableRenderingOptimization;\n\n    config.renderer.getConfig().enableDirtyCheck = false;\n    config.renderer.getConfig().enableDirtyRectangleRendering = false;\n\n    this.rBush = rBushRoot;\n    this.pathGeneratorFactory = pathGeneratorFactory;\n\n    const contextService =\n      context.contextService as ContextService<CanvasRenderingContext2D>;\n\n    const canvas = renderingContext.root.ownerDocument.defaultView;\n\n    const handleUnmounted = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n\n      // remove r-bush node\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode?.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    const handleCulled = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    renderingService.hooks.init.tap(CanvasRendererPlugin.tag, () => {\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(ElementEvent.CULLED, handleCulled);\n\n      // clear fullscreen\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const context = contextService.getContext();\n      this.clearRect(\n        context,\n        0,\n        0,\n        width * dpr,\n        height * dpr,\n        config.background,\n      );\n    });\n\n    renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag, () => {\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(ElementEvent.CULLED, handleCulled);\n      this.renderQueue = [];\n      this.removedRBushNodeAABBs = [];\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: null,\n      };\n    });\n\n    const beforeDraw = () => {\n      const context = contextService.getContext();\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const { dirtyObjectNumThreshold, dirtyObjectRatioThreshold } =\n        this.canvasRendererPluginOptions;\n\n      // some heuristic conditions such as 80% object changed\n      const { total, rendered } = renderingService.getStats();\n      const ratio = rendered / total;\n\n      this.clearFullScreen =\n        this.clearFullScreenLastFrame ||\n        // @ts-ignore\n        !canvas.context.renderingPlugins[1]?.isFirstTimeRenderingFinished ||\n        renderingService.disableDirtyRectangleRendering() ||\n        (rendered > dirtyObjectNumThreshold &&\n          ratio > dirtyObjectRatioThreshold);\n\n      if (!context) {\n        return;\n      }\n\n      if (typeof context.resetTransform === 'function') {\n        context.resetTransform();\n      } else {\n        context.setTransform(1, 0, 0, 1, 0, 0);\n      }\n\n      if (this.clearFullScreen) {\n        this.clearRect(\n          context,\n          0,\n          0,\n          width * dpr,\n          height * dpr,\n          config.background,\n        );\n      }\n    };\n\n    /**\n     * render objects by z-index\n     *\n     * - The level of the child node will be affected by the level of the parent node\n     */\n    const renderByZIndex = (\n      object: DisplayObject,\n      context: CanvasRenderingContext2D,\n    ) => {\n      const stack = [object];\n\n      while (stack.length > 0) {\n        const currentObject = stack.pop();\n\n        if (currentObject.isVisible() && !currentObject.isCulled()) {\n          if (enableRenderingOptimization) {\n            this.renderDisplayObjectOptimized(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          } else {\n            this.renderDisplayObject(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          }\n        }\n\n        const objects =\n          currentObject.sortable?.sorted?.length > 0\n            ? currentObject.sortable.sorted\n            : currentObject.childNodes;\n        // should account for z-index\n        for (let i = objects.length - 1; i >= 0; i--) {\n          stack.push(objects[i] as unknown as DisplayObject);\n        }\n      }\n    };\n\n    // render at the end of frame\n    renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag, () => {\n      beforeDraw();\n\n      // Skip rendering.\n      if (renderingContext.root.childNodes.length === 0) {\n        this.clearFullScreenLastFrame = true;\n        return;\n      }\n\n      enableRenderingOptimization =\n        config.renderer.getConfig().enableRenderingOptimization;\n\n      // init\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: this.#renderState.currentContext,\n      };\n      this.#renderState.currentContext.clear();\n      this.clearFullScreenLastFrame = false;\n\n      const context = contextService.getContext();\n      // clear & clip dirty rectangle\n      const dpr = contextService.getDPR();\n      mat4.fromScaling(this.dprMatrix, [dpr, dpr, 1]);\n      mat4.multiply(this.vpMatrix, this.dprMatrix, camera.getOrthoMatrix());\n\n      if (this.clearFullScreen) {\n        // console.time('renderByZIndex');\n        if (enableRenderingOptimization) {\n          context.save();\n          renderByZIndex(renderingContext.root, context);\n          context.restore();\n        } else {\n          renderByZIndex(renderingContext.root, context);\n        }\n        // console.timeEnd('renderByZIndex');\n\n        this.removedRBushNodeAABBs = [];\n      } else {\n        // console.log('canvas renderer next...', this.renderQueue);\n        // merge removed AABB\n        const dirtyRenderBounds = this.safeMergeAABB(\n          this.mergeDirtyAABBs(this.renderQueue),\n          ...this.removedRBushNodeAABBs.map(({ minX, minY, maxX, maxY }) => {\n            const aabb = new AABB();\n            aabb.setMinMax(\n              // vec3.fromValues(minX, minY, 0),\n              // vec3.fromValues(maxX, maxY, 0),\n              [minX, minY, 0],\n              [maxX, maxY, 0],\n            );\n            return aabb;\n          }),\n        );\n        this.removedRBushNodeAABBs = [];\n\n        if (AABB.isEmpty(dirtyRenderBounds)) {\n          this.renderQueue = [];\n          return;\n        }\n\n        const dirtyRect = this.convertAABB2Rect(dirtyRenderBounds);\n        const { x, y, width, height } = dirtyRect;\n\n        const tl = vec3.transformMat4(this.vec3a, [x, y, 0], this.vpMatrix);\n        const tr = vec3.transformMat4(\n          this.vec3b,\n          [x + width, y, 0],\n          this.vpMatrix,\n        );\n        const bl = vec3.transformMat4(\n          this.vec3c,\n          [x, y + height, 0],\n          this.vpMatrix,\n        );\n        const br = vec3.transformMat4(\n          this.vec3d,\n          [x + width, y + height, 0],\n          this.vpMatrix,\n        );\n\n        const minx = Math.min(tl[0], tr[0], br[0], bl[0]);\n        const miny = Math.min(tl[1], tr[1], br[1], bl[1]);\n        const maxx = Math.max(tl[0], tr[0], br[0], bl[0]);\n        const maxy = Math.max(tl[1], tr[1], br[1], bl[1]);\n\n        const ix = Math.floor(minx);\n        const iy = Math.floor(miny);\n        const iwidth = Math.ceil(maxx - minx);\n        const iheight = Math.ceil(maxy - miny);\n\n        context.save();\n        this.clearRect(context, ix, iy, iwidth, iheight, config.background);\n        context.beginPath();\n        context.rect(ix, iy, iwidth, iheight);\n        context.clip();\n\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n        context.setTransform(\n          this.vpMatrix[0],\n          this.vpMatrix[1],\n          this.vpMatrix[4],\n          this.vpMatrix[5],\n          this.vpMatrix[12],\n          this.vpMatrix[13],\n        );\n\n        // draw dirty rectangle\n        const { enableDirtyRectangleRenderingDebug } =\n          config.renderer.getConfig();\n        if (enableDirtyRectangleRenderingDebug) {\n          canvas.dispatchEvent(\n            new CustomEvent(CanvasEvent.DIRTY_RECTANGLE, {\n              dirtyRect: {\n                x: ix,\n                y: iy,\n                width: iwidth,\n                height: iheight,\n              },\n            }),\n          );\n        }\n\n        // search objects intersect with dirty rectangle\n        const dirtyObjects = this.searchDirtyObjects(dirtyRenderBounds);\n\n        // do rendering\n        dirtyObjects\n          // sort by z-index\n          .sort((a, b) => a.sortable.renderOrder - b.sortable.renderOrder)\n          .forEach((object) => {\n            // culled object should not be rendered\n            if (object && object.isVisible() && !object.isCulled()) {\n              this.renderDisplayObject(\n                object,\n                context,\n                this.context,\n                this.#renderState,\n                runtime,\n              );\n            }\n          });\n\n        context.restore();\n\n        // save dirty AABBs in last frame\n        this.renderQueue.forEach((object) => {\n          this.saveDirtyAABB(object);\n        });\n\n        // clear queue\n        this.renderQueue = [];\n      }\n\n      // pop restore stack, eg. root -> parent -> child\n      this.#renderState.restoreStack.forEach(() => {\n        context.restore();\n      });\n      // clear restore stack\n      this.#renderState.restoreStack = [];\n    });\n\n    renderingService.hooks.render.tap(\n      CanvasRendererPlugin.tag,\n      (object: DisplayObject) => {\n        if (!this.clearFullScreen) {\n          // render at the end of frame\n          this.renderQueue.push(object);\n        }\n      },\n    );\n  }\n\n  private clearRect(\n    context: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    background: string,\n  ) {\n    // clearRect is faster than fillRect @see https://stackoverflow.com/a/30830253\n    context.clearRect(x, y, width, height);\n    if (background) {\n      context.fillStyle = background;\n      context.fillRect(x, y, width, height);\n    }\n  }\n\n  renderDisplayObjectOptimized(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    let updateTransform = false;\n    let clipDraw = false;\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          clipPath.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, clipPath);\n        renderState.prevObject = null;\n      }\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n        clipDraw = true;\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          object.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, object);\n      }\n\n      let forceUpdateStyle = !renderState.prevObject;\n      if (!forceUpdateStyle) {\n        const prevNodeName = renderState.prevObject.nodeName as Shape;\n\n        if (nodeName === Shape.TEXT) {\n          forceUpdateStyle = prevNodeName !== Shape.TEXT;\n        } else if (nodeName === Shape.IMAGE) {\n          forceUpdateStyle = prevNodeName !== Shape.IMAGE;\n        } else {\n          forceUpdateStyle =\n            prevNodeName === Shape.TEXT || prevNodeName === Shape.IMAGE;\n        }\n      }\n\n      styleRenderer.applyStyleToContext(\n        context,\n        object,\n        forceUpdateStyle,\n        renderState,\n      );\n\n      renderState.prevObject = object;\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.drawToContext(\n        context,\n        object,\n        this.#renderState,\n        this,\n        runtime,\n      );\n    }\n\n    if (clipDraw) {\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.dirty(false);\n  }\n\n  renderDisplayObject(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    // restore to its ancestor\n\n    const parent =\n      renderState.restoreStack[renderState.restoreStack.length - 1];\n    if (\n      parent &&\n      !(\n        object.compareDocumentPosition(parent) & Node.DOCUMENT_POSITION_CONTAINS\n      )\n    ) {\n      context.restore();\n      renderState.restoreStack.pop();\n    }\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      this.applyWorldTransform(context, clipPath);\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n\n        // save clip\n        renderState.restoreStack.push(object);\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      this.applyWorldTransform(context, object);\n\n      context.save();\n\n      // apply attributes to context\n      this.applyAttributesToContext(context, object);\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.render(\n        context,\n        object.parsedStyle,\n        object,\n        canvasContext,\n        this,\n        runtime,\n      );\n\n      // restore applied attributes, eg. shadowBlur shadowColor...\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.dirty(false);\n  }\n\n  private applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {\n    const { stroke, fill, opacity, lineDash, lineDashOffset } =\n      object.parsedStyle as ParsedBaseStyleProps;\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setLineDash\n    if (lineDash) {\n      context.setLineDash(lineDash);\n    }\n\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n    if (!isNil(lineDashOffset)) {\n      context.lineDashOffset = lineDashOffset;\n    }\n\n    if (!isNil(opacity)) {\n      context.globalAlpha *= opacity;\n    }\n\n    if (\n      !isNil(stroke) &&\n      !Array.isArray(stroke) &&\n      !(stroke as CSSRGB).isNone\n    ) {\n      context.strokeStyle = object.attributes.stroke as string;\n    }\n\n    if (!isNil(fill) && !Array.isArray(fill) && !(fill as CSSRGB).isNone) {\n      context.fillStyle = object.attributes.fill as string;\n    }\n  }\n\n  private convertAABB2Rect(aabb: AABB): Rect {\n    const min = aabb.getMin();\n    const max = aabb.getMax();\n    // expand the rectangle a bit to avoid artifacts\n    // @see https://www.yuque.com/antv/ou292n/bi8nix#ExvCu\n    const minX = Math.floor(min[0]);\n    const minY = Math.floor(min[1]);\n    const maxX = Math.ceil(max[0]);\n    const maxY = Math.ceil(max[1]);\n    const width = maxX - minX;\n    const height = maxY - minY;\n\n    return { x: minX, y: minY, width, height };\n  }\n\n  /**\n   * TODO: merge dirty rectangles with some strategies.\n   * For now, we just simply merge all the rectangles into one.\n   * @see https://idom.me/articles/841.html\n   */\n  private mergeDirtyAABBs(dirtyObjects: DisplayObject[]): AABB {\n    // merge into a big AABB\n    // TODO: skip descendant if ancestor is caculated, but compareNodePosition is really slow\n    const aabb = new AABB();\n    dirtyObjects.forEach((object) => {\n      const renderBounds = object.getRenderBounds();\n      aabb.add(renderBounds);\n\n      const { dirtyRenderBounds } = object.renderable;\n      if (dirtyRenderBounds) {\n        aabb.add(dirtyRenderBounds);\n      }\n    });\n\n    return aabb;\n  }\n\n  private searchDirtyObjects(dirtyRectangle: AABB): DisplayObject[] {\n    // search in r-tree, get all affected nodes\n    const [minX, minY] = dirtyRectangle.getMin();\n    const [maxX, maxY] = dirtyRectangle.getMax();\n    const rBushNodes = this.rBush.search({\n      minX,\n      minY,\n      maxX,\n      maxY,\n    });\n\n    return rBushNodes.map(({ displayObject }) => displayObject);\n  }\n\n  private saveDirtyAABB(object: DisplayObject) {\n    const { renderable } = object;\n    if (!renderable.dirtyRenderBounds) {\n      renderable.dirtyRenderBounds = new AABB();\n    }\n    const renderBounds = object.getRenderBounds();\n    if (renderBounds) {\n      // save last dirty aabb\n      renderable.dirtyRenderBounds.update(\n        renderBounds.center,\n        renderBounds.halfExtents,\n      );\n    }\n  }\n\n  private applyWorldTransform(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    matrix?: mat4,\n  ) {\n    // apply clip shape's RTS\n    if (matrix) {\n      mat4.copy(this.tmpMat4, object.getLocalTransform());\n      mat4.multiply(this.tmpMat4, matrix, this.tmpMat4);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    } else {\n      // apply RTS transformation in world space\n      mat4.copy(this.tmpMat4, object.getWorldTransform());\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    }\n\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n    context.setTransform(\n      this.tmpMat4[0],\n      this.tmpMat4[1],\n      this.tmpMat4[4],\n      this.tmpMat4[5],\n      this.tmpMat4[12],\n      this.tmpMat4[13],\n    );\n  }\n\n  private safeMergeAABB(...aabbs: AABB[]): AABB {\n    const merged = new AABB();\n    aabbs.forEach((aabb) => {\n      merged.add(aabb);\n    });\n    return merged;\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  DisplayObject,\n  GlobalRuntime,\n  LinearGradient,\n  Pattern,\n  RadialGradient,\n  Rect,\n  GradientType,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport function getPattern(\n  pattern: Pattern,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n): CanvasPattern {\n  let $offscreenCanvas: HTMLCanvasElement;\n  let dpr: number;\n  if ((pattern.image as Rect).nodeName === 'rect') {\n    const { width, height } = (pattern.image as Rect).parsedStyle;\n    dpr = canvasContext.contextService.getDPR();\n    const { offscreenCanvas } = canvasContext.config;\n    $offscreenCanvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(\n      offscreenCanvas,\n    ) as HTMLCanvasElement;\n\n    $offscreenCanvas.width = width * dpr;\n    $offscreenCanvas.height = height * dpr;\n\n    const offscreenCanvasContext =\n      runtime.offscreenCanvasCreator.getOrCreateContext(\n        offscreenCanvas,\n      ) as CanvasRenderingContext2D;\n\n    const renderState: RenderState = {\n      restoreStack: [],\n      prevObject: null,\n      currentContext: new Map(),\n    };\n\n    // offscreenCanvasContext.scale(1 / dpr, 1 / dpr);\n\n    (pattern.image as Rect).forEach((object: DisplayObject) => {\n      plugin.renderDisplayObject(\n        object,\n        offscreenCanvasContext,\n        canvasContext,\n        renderState,\n        runtime,\n      );\n    });\n\n    renderState.restoreStack.forEach(() => {\n      offscreenCanvasContext.restore();\n    });\n  }\n\n  const canvasPattern = imagePool.getOrCreatePatternSync(\n    object,\n    pattern,\n    context,\n    $offscreenCanvas,\n    dpr,\n    object.getGeometryBounds().min,\n    () => {\n      // set dirty rectangle flag\n      object.dirty();\n      canvasContext.renderingService.dirty();\n    },\n  );\n\n  return canvasPattern;\n}\n\nexport function getColor(\n  parsedColor: CSSGradientValue,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  imagePool: ImagePool,\n) {\n  let color: CanvasGradient | string;\n\n  if (\n    parsedColor.type === GradientType.LinearGradient ||\n    parsedColor.type === GradientType.RadialGradient\n  ) {\n    const bounds = object.getGeometryBounds();\n    const width = (bounds && bounds.halfExtents[0] * 2) || 1;\n    const height = (bounds && bounds.halfExtents[1] * 2) || 1;\n    const min = (bounds && bounds.min) || [0, 0];\n    color = imagePool.getOrCreateGradient(\n      {\n        type: parsedColor.type,\n        ...(parsedColor.value as LinearGradient & RadialGradient),\n        min: min as [number, number],\n        width,\n        height,\n      },\n      context,\n    );\n  }\n\n  return color;\n}\n","import {\n  CanvasContext,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\nimport type { StyleRenderer } from './interfaces';\nimport { getColor, getPattern } from './helper';\n\nconst SHADOW_NUMBER_STYLE = [\n  'shadowBlur',\n  'shadowOffsetX',\n  'shadowOffsetY',\n] as const;\nconst STROKE_STYLE = ['lineCap', 'lineJoin', 'miterLimit'] as const;\nexport const DEFAULT_STYLE = {\n  // common\n  globalAlpha: 1,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0,\n  shadowColor: '#000',\n  filter: 'none' as const,\n  globalCompositeOperation: 'source-over' as const,\n\n  // stroke/fill\n  strokeStyle: '#000',\n  strokeOpacity: 1,\n  lineWidth: 1,\n  lineDash: [],\n  lineDashOffset: 0,\n  lineCap: 'butt' as const,\n  lineJoin: 'miter' as const,\n  miterLimit: 10,\n  fillStyle: '#000',\n  fillOpacity: 1,\n\n  // image\n};\n\nconst defaultParsedStyle = {} as ParsedBaseStyleProps;\n\n/**\n * Updating the canvas context is an expensive operation. The state of the context is cached and the actual update operation is performed only when the cache is not hit.\n *\n * In any case, the previous value is returned, which is convenient for temporarily updating the context and restoring it later.\n */\nfunction updateContextIfNotHitCache<\n  K extends keyof CanvasRenderingContext2D | 'lineDash',\n  V = unknown,\n>(context: CanvasRenderingContext2D, key: K, value: V, cache: Map<K, unknown>) {\n  const prevValue = (\n    cache.has(key)\n      ? cache.get(key)\n      : DEFAULT_STYLE[key as keyof typeof DEFAULT_STYLE]\n  ) as V;\n\n  if (prevValue !== value) {\n    // console.log('not hit cache', key, value, prevValue, cache);\n    if (key === 'lineDash') {\n      context.setLineDash(value as number[]);\n    } else {\n      // @ts-ignore\n      context[key] = value;\n    }\n    cache.set(key, value);\n  }\n\n  return prevValue;\n}\n\nexport class OptimizedDefaultRenderer implements StyleRenderer {\n  constructor(public imagePool: ImagePool) {}\n\n  applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {}\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {}\n\n  // #region common style\n  private applyCommonStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    // const dpr = object.ownerDocument.defaultView.getContextService().getDPR();\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n\n    if (forceUpdate || style.opacity !== prevStyle.opacity) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        !isNil(style.opacity) ? style.opacity : DEFAULT_STYLE.globalAlpha,\n        renderState.currentContext,\n      );\n    }\n\n    // TODO blend prop\n    // @ts-ignore\n    if (forceUpdate || style.blend !== prevStyle.blend) {\n      updateContextIfNotHitCache(\n        context,\n        'globalCompositeOperation',\n        // @ts-ignore\n        !isNil(style.blend)\n          ? // @ts-ignore\n            style.blend\n          : DEFAULT_STYLE.globalCompositeOperation,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion common style\n\n  // #region stroke/fill style\n  private applyStrokeFillStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n    const { lineWidth = DEFAULT_STYLE.lineWidth } = style;\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (hasStroke) {\n      if (\n        forceUpdate ||\n        object.attributes.stroke !== renderState.prevObject.attributes.stroke\n      ) {\n        const value =\n          !isNil(style.stroke) &&\n          !Array.isArray(style.stroke) &&\n          !(style.stroke as CSSRGB).isNone\n            ? object.attributes.stroke\n            : DEFAULT_STYLE.strokeStyle;\n\n        updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          value,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineWidth !== prevStyle.lineWidth) {\n        updateContextIfNotHitCache(\n          context,\n          'lineWidth',\n          !isNil(style.lineWidth) ? style.lineWidth : DEFAULT_STYLE.lineWidth,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDash !== prevStyle.lineDash) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDash',\n          style.lineDash || DEFAULT_STYLE.lineDash,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDashOffset !== prevStyle.lineDashOffset) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDashOffset',\n          !isNil(style.lineDashOffset)\n            ? style.lineDashOffset\n            : DEFAULT_STYLE.lineDashOffset,\n          renderState.currentContext,\n        );\n      }\n\n      for (let i = 0; i < STROKE_STYLE.length; i++) {\n        const styleName = STROKE_STYLE[i];\n        if (forceUpdate || style[styleName] !== prevStyle[styleName]) {\n          updateContextIfNotHitCache(\n            context,\n            styleName,\n            !isNil(style[styleName])\n              ? style[styleName]\n              : DEFAULT_STYLE[styleName],\n            renderState.currentContext,\n          );\n        }\n      }\n    }\n\n    if (\n      hasFill &&\n      (forceUpdate ||\n        object.attributes.fill !== renderState.prevObject.attributes.fill)\n    ) {\n      const value =\n        !isNil(style.fill) &&\n        !Array.isArray(style.fill) &&\n        !(style.fill as CSSRGB).isNone\n          ? object.attributes.fill\n          : DEFAULT_STYLE.fillStyle;\n\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        value,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion stroke/fill style\n\n  applyStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    this.applyCommonStyleToContext(context, object, forceUpdate, renderState);\n\n    if (nodeName === Shape.IMAGE) {\n      //\n    } else {\n      this.applyStrokeFillStyleToContext(\n        context,\n        object,\n        forceUpdate,\n        renderState,\n      );\n    }\n  }\n\n  applyShadowAndFilterStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    hasShadow: boolean,\n    renderState: RenderState,\n  ) {\n    const style = object.parsedStyle;\n\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        style.shadowColor.toString(),\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          style[styleName] || DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (style.filter && style.filter.length) {\n      updateContextIfNotHitCache(\n        context,\n        'filter',\n        // use raw filter string\n        object.attributes.filter,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  clearShadowAndFilterStyleForContext(\n    context: CanvasRenderingContext2D,\n    hasShadow: boolean,\n    hasFilter: boolean,\n    renderState: RenderState,\n    onlyClearShadowFilter = false,\n  ) {\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        DEFAULT_STYLE.shadowColor,\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (hasFilter) {\n      if (hasShadow && onlyClearShadowFilter) {\n        // save drop-shadow filter\n        const oldFilter = context.filter;\n        if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n          updateContextIfNotHitCache(\n            context,\n            'filter',\n            oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() ||\n              DEFAULT_STYLE.filter,\n            renderState.currentContext,\n          );\n        }\n      } else {\n        updateContextIfNotHitCache(\n          context,\n          'filter',\n          DEFAULT_STYLE.filter,\n          renderState.currentContext,\n        );\n      }\n    }\n  }\n\n  fillToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { fill, fillRule } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(fill) && fill.length > 0) {\n      fill.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'fillStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        if (fillRule) {\n          context.fill(fillRule);\n        } else {\n          context.fill();\n        }\n      });\n    } else {\n      if (isPattern(fill)) {\n        const pattern = getPattern(\n          fill,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          context.fillStyle = pattern;\n          resetStyle = true;\n        }\n      }\n\n      if (fillRule) {\n        context.fill(fillRule);\n      } else {\n        context.fill();\n      }\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  strokeToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { stroke } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(stroke) && stroke.length > 0) {\n      stroke.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        context.stroke();\n      });\n    } else {\n      if (isPattern(stroke)) {\n        const pattern = getPattern(\n          stroke,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          const prevStyle = updateContextIfNotHitCache(\n            context,\n            'strokeStyle',\n            pattern,\n            renderState.currentContext,\n          );\n          resetStyle = resetStyle ?? prevStyle;\n        }\n      }\n\n      context.stroke();\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'strokeStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    const style = object.parsedStyle;\n    const {\n      opacity = DEFAULT_STYLE.globalAlpha,\n      fillOpacity = DEFAULT_STYLE.fillOpacity,\n      strokeOpacity = DEFAULT_STYLE.strokeOpacity,\n      lineWidth = DEFAULT_STYLE.lineWidth,\n    } = style;\n\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (!hasFill && !hasStroke) {\n      return;\n    }\n\n    const hasShadow = !isNil(style.shadowColor) && style.shadowBlur > 0;\n    const isInnerShadow = style.shadowType === 'inner';\n    const isFillTransparent = (style.fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(style.filter && style.filter.length);\n    // Shadows can only be applied to fill() or stroke(), the default is fill()\n    const shouldDrawShadowWithStroke =\n      hasShadow &&\n      hasStroke &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    // TODO https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/paint-order\n\n    let originGlobalAlpha: number | null = null;\n\n    if (hasFill) {\n      if (!shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n      }\n\n      const updateOpacity = opacity * fillOpacity;\n\n      originGlobalAlpha = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n\n      this.fillToContext(context, object, renderState, plugin, runtime);\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n    if (hasStroke) {\n      let clearShadowAndFilter = false;\n      const updateOpacity = opacity * strokeOpacity;\n      const prevOpacity = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n      originGlobalAlpha = hasFill ? originGlobalAlpha : prevOpacity;\n\n      if (shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n        clearShadowAndFilter = true;\n\n        if (isInnerShadow) {\n          const originBlend = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'source-atop';\n\n          this.strokeToContext(context, object, renderState, plugin, runtime);\n\n          context.globalCompositeOperation = originBlend;\n          this.clearShadowAndFilterStyleForContext(\n            context,\n            hasShadow,\n            hasFilter,\n            renderState,\n            true,\n          );\n        }\n      }\n\n      this.strokeToContext(context, object, renderState, plugin, runtime);\n\n      if (clearShadowAndFilter) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n\n    // clear\n    if (originGlobalAlpha !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        originGlobalAlpha,\n        renderState.currentContext,\n      );\n    }\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  Pattern,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { CanvasRendererPlugin } from '../../CanvasRendererPlugin';\nimport { OptimizedDefaultRenderer, DEFAULT_STYLE } from './OptimizedDefault';\nimport { getColor, getPattern } from './helper';\n\nexport class DefaultRenderer extends OptimizedDefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const {\n      fill,\n      fillRule,\n      opacity = 1,\n      fillOpacity = 1,\n      stroke,\n      strokeOpacity = 1,\n      lineWidth = 1,\n      lineCap,\n      lineJoin,\n      shadowType,\n      shadowColor,\n      shadowBlur,\n      filter,\n      miterLimit,\n    } = parsedStyle;\n    const hasFill = fill && !(fill as CSSRGB).isNone;\n    const hasStroke = stroke && !(stroke as CSSRGB).isNone && lineWidth > 0;\n\n    const isFillTransparent = (fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(filter && filter.length);\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    const nodeName = object.nodeName as Shape;\n    const isInnerShadow = shadowType === 'inner';\n    const shouldDrawShadowWithStroke =\n      hasStroke &&\n      hasShadow &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    if (hasFill) {\n      context.globalAlpha = opacity * fillOpacity;\n\n      if (!shouldDrawShadowWithStroke) {\n        setShadowAndFilter(object, context, hasShadow);\n      }\n\n      applyFill(\n        context,\n        object,\n        fill,\n        fillRule,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilter(context, hasFilter, hasShadow);\n      }\n    }\n\n    if (hasStroke) {\n      context.globalAlpha = opacity * strokeOpacity;\n      context.lineWidth = lineWidth;\n      if (!isNil(miterLimit)) {\n        context.miterLimit = miterLimit;\n      }\n\n      if (!isNil(lineCap)) {\n        context.lineCap = lineCap;\n      }\n\n      if (!isNil(lineJoin)) {\n        context.lineJoin = lineJoin;\n      }\n\n      if (shouldDrawShadowWithStroke) {\n        if (isInnerShadow) {\n          context.globalCompositeOperation = 'source-atop';\n        }\n        setShadowAndFilter(object, context, true);\n\n        if (isInnerShadow) {\n          applyStroke(\n            context,\n            object,\n            stroke,\n            canvasContext,\n            plugin,\n            runtime,\n            this.imagePool,\n          );\n          context.globalCompositeOperation =\n            DEFAULT_STYLE.globalCompositeOperation;\n          this.clearShadowAndFilter(context, hasFilter, true);\n        }\n      }\n\n      applyStroke(\n        context,\n        object,\n        stroke,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n    }\n  }\n\n  private clearShadowAndFilter(\n    context: CanvasRenderingContext2D,\n    hasFilter: boolean,\n    hasShadow: boolean,\n  ) {\n    if (hasShadow) {\n      context.shadowColor = 'transparent';\n      context.shadowBlur = 0;\n    }\n\n    if (hasFilter) {\n      // save drop-shadow filter\n      const oldFilter = context.filter;\n      if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n        context.filter =\n          oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() || 'none';\n      }\n    }\n  }\n}\n\n/**\n * apply before fill and stroke but only once\n */\nexport function setShadowAndFilter(\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  hasShadow: boolean,\n) {\n  const { filter, shadowColor, shadowBlur, shadowOffsetX, shadowOffsetY } =\n    object.parsedStyle;\n\n  if (filter && filter.length) {\n    // use raw filter string\n    context.filter = object.style.filter;\n  }\n\n  if (hasShadow) {\n    context.shadowColor = shadowColor.toString();\n    context.shadowBlur = shadowBlur || 0;\n    context.shadowOffsetX = shadowOffsetX || 0;\n    context.shadowOffsetY = shadowOffsetY || 0;\n  }\n}\n\nexport function applyFill(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  fill: CSSRGB | CSSGradientValue[] | Pattern,\n  fillRule: 'nonzero' | 'evenodd',\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipFill = false,\n) {\n  if (Array.isArray(fill)) {\n    fill.forEach((gradient) => {\n      context.fillStyle = getColor(gradient, object, context, imagePool);\n      if (!skipFill) {\n        fillRule ? context.fill(fillRule) : context.fill();\n      }\n    });\n  } else {\n    if (isPattern(fill)) {\n      context.fillStyle = getPattern(\n        fill,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipFill) {\n      fillRule ? context.fill(fillRule) : context.fill();\n    }\n  }\n}\n\nexport function applyStroke(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  stroke: CSSRGB | CSSGradientValue[] | Pattern,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipStroke = false,\n) {\n  if (Array.isArray(stroke)) {\n    stroke.forEach((gradient) => {\n      context.strokeStyle = getColor(gradient, object, context, imagePool);\n      if (!skipStroke) {\n        context.stroke();\n      }\n    });\n  } else {\n    if (isPattern(stroke)) {\n      context.strokeStyle = getPattern(\n        stroke,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipStroke) {\n      context.stroke();\n    }\n  }\n}\n","import { vec3, mat4 } from 'gl-matrix';\n\n/**\n * 判断两个点是否重合，点坐标的格式为 [x, y]\n */\nexport function isSamePoint(\n  point1: [number, number],\n  point2: [number, number],\n) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\n\nexport function calculateOverlapRect<\n  Rect extends [number, number, number, number],\n>(rect1: Rect, rect2: Rect): null | Rect {\n  const [x1, y1, w1, h1] = rect1;\n  const [x2, y2, w2, h2] = rect2;\n\n  // 计算重叠区域的左上角和右下角\n  const overlapLeft = Math.max(x1, x2);\n  const overlapTop = Math.max(y1, y2);\n  const overlapRight = Math.min(x1 + w1, x2 + w2);\n  const overlapBottom = Math.min(y1 + h1, y2 + h2);\n\n  if (overlapRight <= overlapLeft || overlapBottom <= overlapTop) {\n    return null;\n  }\n\n  return [\n    overlapLeft,\n    overlapTop,\n    overlapRight - overlapLeft,\n    overlapBottom - overlapTop,\n  ] as Rect;\n}\n\nexport function transformRect<Rect extends [number, number, number, number]>(\n  rect: Rect,\n  matrix: mat4,\n): Rect {\n  const tl = vec3.transformMat4(vec3.create(), [rect[0], rect[1], 0], matrix);\n  const tr = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1], 0],\n    matrix,\n  );\n  const bl = vec3.transformMat4(\n    vec3.create(),\n    [rect[0], rect[1] + rect[3], 0],\n    matrix,\n  );\n  const br = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1] + rect[3], 0],\n    matrix,\n  );\n\n  return [\n    Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.min(tl[1], tr[1], bl[1], br[1]),\n    Math.max(tl[0], tr[0], bl[0], br[0]) - Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.max(tl[1], tr[1], bl[1], br[1]) - Math.min(tl[1], tr[1], bl[1], br[1]),\n  ] as Rect;\n}\n","import type {\n  DisplayObject,\n  ParsedImageStyleProps,\n  GlobalRuntime,\n} from '@antv/g-lite';\nimport { ImagePool, type ImageCache } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { mat4 } from 'gl-matrix';\nimport { transformRect, calculateOverlapRect } from '../../utils/math';\nimport { DefaultRenderer, setShadowAndFilter } from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class ImageRenderer extends DefaultRenderer {\n  static renderFull(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      image: HTMLImageElement;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    context.drawImage(\n      data.image,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  private renderDownSampled(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache } = data;\n\n    if (!imageCache.downSampled) {\n      this.imagePool\n        .createDownSampledImage(src, object)\n        .then(() => {\n          // be removed from dom tree\n          if (!object.ownerDocument) {\n            return;\n          }\n\n          // rerender\n          object.dirty();\n          object.ownerDocument.defaultView.context.renderingService.dirty();\n        })\n        .catch((reason) => {\n          console.error(reason);\n        });\n\n      return;\n    }\n\n    context.drawImage(\n      imageCache.downSampled,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  renderTile(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      imageRect: [number, number, number, number];\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache, imageRect, drawRect } = data;\n    const { size: originalSize } = imageCache;\n    const { a, b, c, d, e, f } = context.getTransform();\n\n    context.resetTransform();\n\n    if (!imageCache?.gridSize) {\n      this.imagePool\n        .createImageTiles(\n          src,\n          [],\n          () => {\n            // be removed from dom tree\n            if (!object.ownerDocument) {\n              return;\n            }\n\n            // rerender\n            object.dirty();\n            object.ownerDocument.defaultView.context.renderingService.dirty();\n          },\n          object,\n        )\n        .catch((reason) => {\n          console.error(reason);\n        });\n\n      return;\n    }\n\n    const scaleToOrigin = [\n      originalSize[0] / imageRect[2],\n      originalSize[1] / imageRect[3],\n    ];\n    const scaledTileSize = [\n      imageCache.tileSize[0] / scaleToOrigin[0],\n      imageCache.tileSize[1] / scaleToOrigin[1],\n    ];\n    const [startTileX, endTileX] = [\n      Math.floor((drawRect[0] - imageRect[0]) / scaledTileSize[0]),\n      Math.ceil((drawRect[0] + drawRect[2] - imageRect[0]) / scaledTileSize[0]),\n    ];\n    const [startTileY, endTileY] = [\n      Math.floor((drawRect[1] - imageRect[1]) / scaledTileSize[1]),\n      Math.ceil((drawRect[1] + drawRect[3] - imageRect[1]) / scaledTileSize[1]),\n    ];\n\n    for (let tileY = startTileY; tileY <= endTileY; tileY++) {\n      for (let tileX = startTileX; tileX <= endTileX; tileX++) {\n        const item = imageCache.tiles[tileY][tileX];\n\n        if (item) {\n          const tileRect = [\n            Math.floor(imageRect[0] + item.tileX * scaledTileSize[0]),\n            Math.floor(imageRect[1] + item.tileY * scaledTileSize[1]),\n            Math.ceil(scaledTileSize[0]),\n            Math.ceil(scaledTileSize[1]),\n          ];\n\n          context.drawImage(\n            item.data,\n            tileRect[0],\n            tileRect[1],\n            tileRect[2],\n            tileRect[3],\n          );\n        }\n      }\n    }\n\n    context.setTransform(a, b, c, d, e, f);\n  }\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n  ) {\n    const {\n      x = 0,\n      y = 0,\n      width,\n      height,\n      src,\n      shadowColor,\n      shadowBlur,\n    } = parsedStyle;\n\n    const imageCache = this.imagePool.getImageSync(src, object);\n    const image = imageCache?.img;\n    let iw = width;\n    let ih = height;\n\n    if (!image) {\n      return;\n    }\n\n    iw ||= image.width;\n    ih ||= image.height;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // node-canvas will throw the following err:\n    // Error: Image given has not completed loading\n    try {\n      const { width: viewWidth, height: viewHeight } =\n        object.ownerDocument.defaultView.getContextService().getDomElement();\n\n      const currentTransform = context.getTransform();\n      const { a, b, c, d, e, f } = currentTransform;\n      // 构建 mat4 矩阵\n      // prettier-ignore\n      const transformMatrix = mat4.fromValues(\n          a, c, 0, 0,\n          b, d, 0, 0,\n          0, 0, 1, 0,\n          e, f, 0, 1,\n        );\n      const imageRect = transformRect([x, y, iw, ih], transformMatrix);\n      const drawRect = calculateOverlapRect(\n        [0, 0, viewWidth, viewHeight],\n        imageRect,\n      );\n\n      if (!drawRect) {\n        return;\n      }\n\n      if (\n        !object.ownerDocument.defaultView.getConfig()\n          .enableLargeImageOptimization\n      ) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      const sizeOfOrigin = imageRect[2] / imageCache.size[0];\n\n      if (sizeOfOrigin < (imageCache.downSamplingRate || 0.5)) {\n        this.renderDownSampled(context, parsedStyle, object, {\n          src,\n          imageCache,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      if (!ImagePool.isSupportTile) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      this.renderTile(context, parsedStyle, object, {\n        src,\n        imageCache,\n        imageRect,\n        drawRect,\n      });\n    } catch {\n      // expected error\n    }\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(context, object.parsedStyle as ParsedImageStyleProps, object);\n  }\n}\n","import {\n  type CSSRGB,\n  type CanvasContext,\n  type DisplayObject,\n  type GlobalRuntime,\n  type ParsedTextStyleProps,\n  type Rectangle,\n  CSSGradientValue,\n  Pattern,\n} from '@antv/g-lite';\nimport { isNil } from '@antv/util';\nimport {\n  DefaultRenderer,\n  applyFill,\n  applyStroke,\n  setShadowAndFilter,\n} from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class TextRenderer extends DefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedTextStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    // Trigger text geometry calculation.\n    object.getBounds();\n    const {\n      lineWidth = 1,\n      textAlign = 'start',\n      textBaseline = 'alphabetic',\n      lineJoin = 'miter',\n      miterLimit = 10,\n      letterSpacing = 0,\n      stroke,\n      fill,\n      fillRule,\n      fillOpacity = 1,\n      strokeOpacity = 1,\n      opacity = 1,\n      metrics,\n      x = 0,\n      y = 0,\n      dx,\n      dy,\n      shadowColor,\n      shadowBlur,\n      textDecorationLine,\n    } = parsedStyle;\n\n    const { font, lines, height, lineHeight, lineMetrics } = metrics;\n\n    context.font = font;\n    context.lineWidth = lineWidth;\n    context.textAlign = textAlign === 'middle' ? 'center' : textAlign;\n\n    let formattedTextBaseline = textBaseline;\n    if (formattedTextBaseline === 'alphabetic') {\n      formattedTextBaseline = 'bottom';\n    }\n\n    context.lineJoin = lineJoin;\n    if (!isNil(miterLimit)) {\n      context.miterLimit = miterLimit;\n    }\n\n    let linePositionY = y;\n    // handle vertical text baseline\n    if (textBaseline === 'middle') {\n      linePositionY += -height / 2 - lineHeight / 2;\n    } else if (\n      textBaseline === 'bottom' ||\n      textBaseline === 'alphabetic' ||\n      textBaseline === 'ideographic'\n    ) {\n      linePositionY += -height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY += -lineHeight;\n    }\n\n    // account for dx & dy\n    const offsetX = x + (dx || 0);\n    linePositionY += dy || 0;\n\n    if (lines.length === 1) {\n      if (formattedTextBaseline === 'bottom') {\n        formattedTextBaseline = 'middle';\n        linePositionY -= 0.5 * height;\n      } else if (formattedTextBaseline === 'top') {\n        formattedTextBaseline = 'middle';\n        linePositionY += 0.5 * height;\n      }\n    }\n    context.textBaseline = formattedTextBaseline;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // draw lines line by line\n    for (let i = 0; i < lines.length; i++) {\n      const linePositionX = lineWidth / 2 + offsetX;\n      linePositionY += lineHeight;\n\n      // no need to re-position X, cause we already set text align\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\n      if (!isNil(stroke) && !(stroke as CSSRGB).isNone && lineWidth) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          true,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      if (!isNil(fill)) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          false,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n    }\n\n    // Draw text decoration lines\n    if (textDecorationLine && textDecorationLine !== 'none') {\n      this.drawTextDecorations(\n        context,\n        parsedStyle,\n        object,\n        lines,\n        lineHeight,\n        offsetX,\n        y + (dy || 0),\n        canvasContext,\n        plugin,\n        runtime,\n      );\n    }\n  }\n\n  private drawLetterSpacing(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    lineMetrics: Rectangle,\n    textAlign: CanvasTextAlign | 'middle',\n    x: number,\n    y: number,\n    letterSpacing: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    opacity: number | undefined,\n    isStroke: boolean,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ): void {\n    // letterSpacing of 0 means normal, render all texts directly\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      return;\n    }\n\n    // draw text using left align\n    const currentTextAlign = context.textAlign;\n    context.textAlign = 'left';\n\n    let currentPosition = x;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      currentPosition = x - lineMetrics.width / 2;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      currentPosition = x - lineMetrics.width;\n    }\n\n    const stringArray = Array.from(text);\n    let previousWidth = context.measureText(text).width;\n    let currentWidth = 0;\n    for (let i = 0; i < stringArray.length; ++i) {\n      const currentChar = stringArray[i];\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      currentWidth = context.measureText(text.substring(i + 1)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n\n    context.textAlign = currentTextAlign;\n  }\n\n  private fillText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    opacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyFill(\n      context,\n      object,\n      fill,\n      fillRule,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(fillOpacity) && fillOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = fillOpacity * opacity;\n    }\n    context.fillText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  private strokeText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyStroke(\n      context,\n      object,\n      stroke,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(strokeOpacity) && strokeOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = strokeOpacity!;\n    }\n    context.strokeText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  /**\n   * Draw text decoration lines (underline, overline, line-through)\n   */\n  private drawTextDecorations(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedTextStyleProps,\n    object: DisplayObject,\n    lines: string[],\n    lineHeight: number,\n    offsetX: number,\n    baseY: number,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const {\n      textDecorationLine,\n      textDecorationColor,\n      textDecorationStyle,\n      textDecorationThickness = 1,\n      textAlign = 'start',\n      lineWidth = 1,\n      metrics,\n    } = parsedStyle;\n\n    if (!textDecorationLine || textDecorationLine === 'none') {\n      return;\n    }\n\n    const { lineMetrics } = metrics;\n    const decorations = textDecorationLine.split(' ');\n\n    // Set decoration style\n    context.lineWidth = textDecorationThickness;\n\n    if (textDecorationColor) {\n      context.strokeStyle = `rgba(${textDecorationColor.r}, ${textDecorationColor.g}, ${textDecorationColor.b}, ${textDecorationColor.alpha})`;\n    }\n\n    // Set line style based on textDecorationStyle\n    switch (textDecorationStyle) {\n      case 'dashed':\n        context.setLineDash([5, 5]);\n        break;\n      case 'dotted':\n        context.setLineDash([2, 2]);\n        break;\n      case 'wavy':\n        // For wavy, we'll use a simple approximation with bezier curves\n        // A full implementation would be more complex\n        context.setLineDash([]);\n        break;\n      default:\n        context.setLineDash([]);\n        break;\n    }\n\n    let linePositionY = baseY;\n\n    // Adjust for text baseline\n    const { textBaseline = 'alphabetic' } = parsedStyle;\n    if (textBaseline === 'middle') {\n      linePositionY += -metrics.height / 2 - lineHeight / 2;\n    } else if (\n      textBaseline === 'bottom' ||\n      textBaseline === 'alphabetic' ||\n      textBaseline === 'ideographic'\n    ) {\n      linePositionY += -metrics.height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY += -lineHeight;\n    }\n\n    // Draw each decoration for each line\n    for (let i = 0; i < lines.length; i++) {\n      linePositionY += lineHeight;\n\n      const lineMetric = lineMetrics[i];\n      if (!lineMetric) continue;\n\n      const lineWidthOffset = lineWidth / 2;\n      let startX = offsetX;\n      let endX = offsetX + lineMetric.width;\n\n      // Adjust for text alignment\n      if (textAlign === 'center' || textAlign === 'middle') {\n        startX = offsetX - lineMetric.width / 2;\n        endX = offsetX + lineMetric.width / 2;\n      } else if (textAlign === 'right' || textAlign === 'end') {\n        startX = offsetX - lineMetric.width;\n        endX = offsetX;\n      }\n\n      // Add lineWidth offset\n      startX += lineWidthOffset;\n      endX += lineWidthOffset;\n\n      // Draw each type of decoration\n      for (const decoration of decorations) {\n        let decorationY = linePositionY;\n\n        switch (decoration) {\n          case 'underline':\n            decorationY += 2; // Small offset below baseline\n            break;\n          case 'overline':\n            decorationY -= lineHeight - 2; // Small offset above line\n            break;\n          case 'line-through':\n            decorationY -= lineHeight / 2; // Middle of line\n            break;\n          default:\n            continue; // Unknown decoration type\n        }\n\n        if (textDecorationStyle === 'wavy') {\n          this.drawWavyLine(context, startX, endX, decorationY);\n        } else {\n          context.beginPath();\n          context.moveTo(startX, decorationY);\n          context.lineTo(endX, decorationY);\n          context.stroke();\n        }\n      }\n    }\n\n    // Reset line dash\n    context.setLineDash([]);\n  }\n\n  /**\n   * Draw a wavy line as an approximation of the wavy text decoration style\n   */\n  private drawWavyLine(\n    context: CanvasRenderingContext2D,\n    startX: number,\n    endX: number,\n    y: number,\n  ) {\n    const amplitude = 2; // Height of the wave\n    const wavelength = 10; // Length of one wave cycle\n    const numWaves = Math.floor((endX - startX) / wavelength);\n\n    context.beginPath();\n    context.moveTo(startX, y);\n\n    for (let i = 0; i < numWaves; i++) {\n      const x1 = startX + i * wavelength + wavelength / 4;\n      const y1 = y + amplitude;\n      const x2 = startX + i * wavelength + wavelength / 2;\n      const y2 = y;\n      context.quadraticCurveTo(x1, y1, x2, y2);\n\n      const x3 = startX + i * wavelength + (wavelength * 3) / 4;\n      const y3 = y - amplitude;\n      const x4 = startX + (i + 1) * wavelength;\n      const y4 = y;\n      context.quadraticCurveTo(x3, y3, x4, y4);\n    }\n\n    context.stroke();\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(\n      context,\n      object.parsedStyle as ParsedTextStyleProps,\n      object,\n      object.ownerDocument.defaultView.context,\n      plugin,\n      runtime,\n    );\n  }\n}\n","import { AbstractRendererPlugin, Shape } from '@antv/g-lite';\nimport type { PathGenerator } from '@antv/g-plugin-canvas-path-generator';\nimport { CanvasRendererPlugin } from './CanvasRendererPlugin';\nimport {\n  type StyleRenderer,\n  DefaultRenderer,\n  TextRenderer,\n  ImageRenderer,\n} from './shapes/styles';\nimport type { CanvasRendererPluginOptions } from './interfaces';\n\nexport * from './shapes/styles';\n\nexport class Plugin extends AbstractRendererPlugin<{\n  defaultStyleRendererFactory: Record<Shape, StyleRenderer>;\n  styleRendererFactory: Record<Shape, StyleRenderer>;\n  pathGeneratorFactory: Record<Shape, PathGenerator<any>>;\n}> {\n  name = 'canvas-renderer';\n\n  constructor(private options: Partial<CanvasRendererPluginOptions> = {}) {\n    super();\n  }\n\n  init(): void {\n    const canvasRendererPluginOptions: CanvasRendererPluginOptions = {\n      dirtyObjectNumThreshold: 500,\n      dirtyObjectRatioThreshold: 0.8,\n      ...this.options,\n    };\n\n    // @ts-ignore\n    const { imagePool } = this.context;\n\n    const defaultRenderer = new DefaultRenderer(imagePool);\n\n    const defaultStyleRendererFactory: Record<Shape, StyleRenderer> = {\n      [Shape.CIRCLE]: defaultRenderer,\n      [Shape.ELLIPSE]: defaultRenderer,\n      [Shape.RECT]: defaultRenderer,\n      [Shape.IMAGE]: new ImageRenderer(imagePool),\n      [Shape.TEXT]: new TextRenderer(imagePool),\n      [Shape.LINE]: defaultRenderer,\n      [Shape.POLYLINE]: defaultRenderer,\n      [Shape.POLYGON]: defaultRenderer,\n      [Shape.PATH]: defaultRenderer,\n      [Shape.GROUP]: undefined,\n      [Shape.HTML]: undefined,\n      [Shape.MESH]: undefined,\n      [Shape.FRAGMENT]: undefined,\n    };\n\n    this.context.defaultStyleRendererFactory = defaultStyleRendererFactory;\n    this.context.styleRendererFactory = defaultStyleRendererFactory;\n\n    this.addRenderingPlugin(\n      new CanvasRendererPlugin(canvasRendererPluginOptions),\n    );\n  }\n  destroy(): void {\n    this.removeAllRenderingPlugins();\n\n    delete this.context.defaultStyleRendererFactory;\n    delete this.context.styleRendererFactory;\n  }\n}\n"],"names":["_renderState","_classPrivateFieldLooseKey","CanvasRendererPlugin","canvasRendererPluginOptions","_classCallCheck","removedRBushNodeAABBs","renderQueue","Object","defineProperty","writable","value","restoreStack","prevObject","currentContext","Map","clearFullScreenLastFrame","clearFullScreen","vpMatrix","mat4","create","dprMatrix","tmpMat4","vec3a","vec3","vec3b","vec3c","vec3d","_createClass","key","apply","context","runtime","_this","_this$context","config","camera","renderingService","renderingContext","rBushRoot","pathGeneratorFactory","enableRenderingOptimization","renderer","getConfig","enableDirtyCheck","enableDirtyRectangleRendering","rBush","contextService","canvas","root","ownerDocument","defaultView","handleUnmounted","e","object","target","rBushNode","aabb","push","handleCulled","hooks","init","tap","tag","addEventListener","ElementEvent","UNMOUNTED","CULLED","dpr","getDPR","width","height","getContext","clearRect","background","destroy","removeEventListener","_classPrivateFieldLooseBase","beforeDraw","_canvas$context$rende","_this$canvasRendererP","dirtyObjectNumThreshold","dirtyObjectRatioThreshold","_renderingService$get","getStats","total","rendered","ratio","renderingPlugins","isFirstTimeRenderingFinished","disableDirtyRectangleRendering","resetTransform","setTransform","renderByZIndex","stack","length","_currentObject$sortab","currentObject","pop","isVisible","isCulled","renderDisplayObjectOptimized","renderDisplayObject","objects","sortable","sorted","childNodes","i","endFrame","clear","fromScaling","multiply","getOrthoMatrix","save","restore","dirtyRenderBounds","safeMergeAABB","mergeDirtyAABBs","concat","_toConsumableArray","map","_ref","minX","minY","maxX","maxY","AABB","setMinMax","isEmpty","dirtyRect","convertAABB2Rect","x","y","tl","transformMat4","tr","bl","br","minx","Math","min","miny","maxx","max","maxy","ix","floor","iy","iwidth","ceil","iheight","beginPath","rect","clip","_config$renderer$getC","enableDirtyRectangleRenderingDebug","dispatchEvent","CustomEvent","CanvasEvent","DIRTY_RECTANGLE","dirtyObjects","searchDirtyObjects","sort","a","b","renderOrder","forEach","saveDirtyAABB","render","fillStyle","fillRect","canvasContext","renderState","nodeName","updateTransform","clipDraw","styleRenderer","styleRendererFactory","generatePath","clipPath","parsedStyle","exactEquals","getWorldTransform","applyWorldTransform","closePath","forceUpdateStyle","prevNodeName","Shape","TEXT","IMAGE","applyStyleToContext","LINE","PATH","POLYLINE","drawToContext","dirty","parent","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","applyAttributesToContext","_ref2","stroke","fill","opacity","lineDash","lineDashOffset","setLineDash","isNil","globalAlpha","Array","isArray","isNone","strokeStyle","attributes","getMin","getMax","renderBounds","getRenderBounds","add","renderable","dirtyRectangle","_dirtyRectangle$getMi","_dirtyRectangle$getMi2","_slicedToArray","_dirtyRectangle$getMa","_dirtyRectangle$getMa2","rBushNodes","search","_ref3","displayObject","update","center","halfExtents","matrix","copy","getLocalTransform","merged","_len","arguments","aabbs","_key","getPattern","pattern","plugin","imagePool","$offscreenCanvas","image","_parsedStyle","offscreenCanvas","offscreenCanvasCreator","getOrCreateCanvas","offscreenCanvasContext","getOrCreateContext","canvasPattern","getOrCreatePatternSync","getGeometryBounds","getColor","parsedColor","color","type","GradientType","LinearGradient","RadialGradient","bounds","getOrCreateGradient","_objectSpread","SHADOW_NUMBER_STYLE","STROKE_STYLE","DEFAULT_STYLE","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","filter","globalCompositeOperation","strokeOpacity","lineWidth","lineCap","lineJoin","miterLimit","fillOpacity","defaultParsedStyle","updateContextIfNotHitCache","cache","prevValue","has","get","set","OptimizedDefaultRenderer","applyCommonStyleToContext","forceUpdate","prevStyle","style","blend","applyStrokeFillStyleToContext","_style$lineWidth","hasFill","hasStroke","styleName","applyShadowAndFilterStyleToContext","hasShadow","toString","clearShadowAndFilterStyleForContext","hasFilter","onlyClearShadowFilter","undefined","oldFilter","indexOf","replace","trim","fillToContext","_object$parsedStyle","fillRule","resetStyle","gradient","isPattern","strokeToContext","_this2","_style$fill","_style$opacity","_style$fillOpacity","_style$strokeOpacity","_style$lineWidth2","isInnerShadow","shadowType","isFillTransparent","alpha","shouldDrawShadowWithStroke","originGlobalAlpha","updateOpacity","clearShadowAndFilter","prevOpacity","originBlend","DefaultRenderer","_OptimizedDefaultRend","_callSuper","_inherits","_parsedStyle$opacity","_parsedStyle$fillOpac","_parsedStyle$strokeOp","_parsedStyle$lineWidt","setShadowAndFilter","applyFill","applyStroke","skipFill","skipStroke","calculateOverlapRect","rect1","rect2","_rect","x1","y1","w1","h1","_rect2","x2","y2","w2","h2","overlapLeft","overlapTop","overlapRight","overlapBottom","transformRect","ImageRenderer","_DefaultRenderer","renderDownSampled","data","src","imageCache","downSampled","createDownSampledImage","then","reason","console","error","drawImage","drawRect","renderTile","imageRect","originalSize","size","_context$getTransform","getTransform","c","d","f","gridSize","createImageTiles","scaleToOrigin","scaledTileSize","tileSize","startTileX","endTileX","startTileY","endTileY","tileY","tileX","item","tiles","tileRect","_parsedStyle$x","_parsedStyle$y","getImageSync","img","iw","ih","_object$ownerDocument","getContextService","getDomElement","viewWidth","viewHeight","currentTransform","transformMatrix","fromValues","enableLargeImageOptimization","renderFull","sizeOfOrigin","downSamplingRate","ImagePool","isSupportTile","_unused","TextRenderer","getBounds","_parsedStyle$textAlig","textAlign","_parsedStyle$textBase","textBaseline","_parsedStyle$lineJoin","_parsedStyle$miterLim","_parsedStyle$letterSp","letterSpacing","metrics","dx","dy","textDecorationLine","font","lines","lineHeight","lineMetrics","formattedTextBaseline","linePositionY","offsetX","linePositionX","drawLetterSpacing","drawTextDecorations","text","isStroke","strokeText","fillText","currentTextAlign","currentPosition","stringArray","from","previousWidth","measureText","currentWidth","currentChar","substring","currentGlobalAlpha","applyOpacity","baseY","textDecorationColor","textDecorationStyle","_parsedStyle$textDeco","textDecorationThickness","_parsedStyle$textAlig2","_parsedStyle$lineWidt2","decorations","split","r","g","_parsedStyle$textBase2","lineMetric","lineWidthOffset","startX","endX","_iterator","_createForOfIteratorHelper","_step","s","n","done","decoration","decorationY","drawWavyLine","moveTo","lineTo","err","amplitude","wavelength","numWaves","quadraticCurveTo","x3","y3","x4","y4","Plugin","_AbstractRendererPlug","options","name","_defaultStyleRenderer","defaultRenderer","defaultStyleRendererFactory","_defineProperty","CIRCLE","ELLIPSE","RECT","POLYGON","GROUP","HTML","MESH","FRAGMENT","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"mappings":"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"}